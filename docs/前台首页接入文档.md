# å‰å°ç³»ç»ŸAPIæ¥å…¥æ–‡æ¡£ - é¦–é¡µæ¨èç³»ç»Ÿ

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†å‰å°ç³»ç»Ÿæ¥å…¥é¦–é¡µæ¨èç³»ç»Ÿçš„APIæ¥å£ï¼ŒåŒ…æ‹¬å…¬å¼€æ¥å£å’Œä¸ªæ€§åŒ–æ¨èæ¥å£ã€‚ç³»ç»Ÿæä¾›ä¸¤å¥—æ¨èæ–¹æ¡ˆï¼š

- **å…¬å¼€æ¨è**ï¼šé¢å‘æ‰€æœ‰ç”¨æˆ·çš„é€šç”¨æ¨èï¼ˆæ— éœ€ç™»å½•ï¼‰
- **ä¸ªæ€§åŒ–æ¨è**ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºçš„ç²¾å‡†æ¨èï¼ˆéœ€è¦ç™»å½•ï¼‰

## ğŸŒ æ¥å£åŸŸå

```
BASE_URL: http://localhost:3000
```

## ğŸ” è®¤è¯è¯´æ˜

### å…¬å¼€æ¥å£

- æ— éœ€è®¤è¯ï¼Œç›´æ¥è°ƒç”¨

### ä¸ªæ€§åŒ–æ¨èæ¥å£

- éœ€è¦JWT Tokenè®¤è¯
- Headerä¸­æ·»åŠ ï¼š`Authorization: Bearer {token}`

---

## ğŸ“± ä¸€ã€å…¬å¼€æ¨èæ¥å£ï¼ˆæ— éœ€ç™»å½•ï¼‰

### 1.1 è·å–å®Œæ•´é¦–é¡µæ•°æ®

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/data`

**æè¿°ï¼š** ä¸€æ¬¡æ€§è·å–é¦–é¡µæ‰€éœ€çš„å…¨éƒ¨æ•°æ®ï¼ŒåŒ…æ‹¬è½®æ’­å›¾å’Œå„ç±»æ¨èå†…å®¹

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| userId | number | å¦ | ç”¨æˆ·IDï¼Œä¼ å…¥åå¯è·å¾—ä¸ªæ€§åŒ–å†…å®¹ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// è·å–é€šç”¨é¦–é¡µæ•°æ®
fetch('/public/homepage/data');

// è·å–å¸¦ä¸ªæ€§åŒ–çš„é¦–é¡µæ•°æ®ï¼ˆå·²ç™»å½•ç”¨æˆ·ï¼‰
fetch('/public/homepage/data?userId=123');
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "code": 200,
  "message": "è·å–é¦–é¡µæ•°æ®æˆåŠŸ",
  "data": {
    "banners": [
      {
        "id": 1,
        "title": "æ˜¥å­£æ–°å“å‘å¸ƒ",
        "imageUrl": "https://example.com/banner1.jpg",
        "linkUrl": "/products/spring-2024",
        "sortOrder": 1
      }
    ],
    "recommendations": {
      "hotBooths": [
        {
          "id": "123",
          "boothName": "ç¾é£Ÿæ¡£å£",
          "description": "ç²¾é€‰ç¾é£Ÿ",
          "imageUrl": "https://example.com/booth123.jpg",
          "score": 95.5
        }
      ],
      "latestBooths": [],
      "hotProducts": [],
      "latestProducts": [],
      "personalizedBooths": [], // ä»…åœ¨ä¼ å…¥userIdæ—¶åŒ…å«
      "personalizedProducts": [] // ä»…åœ¨ä¼ å…¥userIdæ—¶åŒ…å«
    },
    "metadata": {
      "hasPersonalization": false,
      "userType": "guest",
      "generatedAt": "2024-01-01T12:00:00Z"
    },
    "timestamp": "2024-01-01T12:00:00Z",
    "fromCache": true
  }
}
```

### 1.2 è·å–æ¡£å£æ¨è

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/booth-recommendations`

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| type | string | å¦ | æ¨èç±»å‹ï¼š`booth_hot`(çƒ­é—¨) / `booth_new`(æœ€æ–°) |
| limit | number | å¦ | æ•°é‡é™åˆ¶ï¼Œé»˜è®¤8 |
| userId | number | å¦ | ç”¨æˆ·ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// è·å–çƒ­é—¨æ¡£å£
fetch('/public/homepage/booth-recommendations?type=booth_hot&limit=8');

// è·å–æœ€æ–°æ¡£å£
fetch('/public/homepage/booth-recommendations?type=booth_new&limit=6');
```

### 1.3 è·å–å•†å“æ¨è

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/product-recommendations`

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| type | string | å¦ | æ¨èç±»å‹ï¼š`product_hot`(çƒ­é—¨) / `product_new`(æœ€æ–°) |
| limit | number | å¦ | æ•°é‡é™åˆ¶ï¼Œé»˜è®¤12 |
| userId | number | å¦ | ç”¨æˆ·ID |

### 1.4 è·å–è½®æ’­å›¾

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/banners`

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| limit | number | å¦ | æ•°é‡é™åˆ¶ï¼Œé»˜è®¤5 |

---

## ğŸ‘¤ äºŒã€ä¸ªæ€§åŒ–æ¨èæ¥å£ï¼ˆéœ€è¦ç™»å½•ï¼‰

> **é‡è¦ï¼š** æ‰€æœ‰ä¸ªæ€§åŒ–æ¨èæ¥å£éƒ½éœ€è¦åœ¨Headerä¸­æºå¸¦JWT Token

### 2.1 ä¸ªæ€§åŒ–æ¡£å£æ¨è

**æ¥å£åœ°å€ï¼š** `GET /api/recommendations/personalized/booths`

**è®¤è¯ï¼š** éœ€è¦JWT Token

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| limit | number | å¦ | æ¨èæ•°é‡ï¼Œé»˜è®¤10 |
| days | number | å¦ | åˆ†ææœ€è¿‘å‡ å¤©çš„è¡Œä¸ºæ•°æ®ï¼Œé»˜è®¤30å¤© |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
fetch('/api/recommendations/personalized/booths?limit=8&days=30', {
  headers: {
    Authorization: `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
});
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "id": "123",
        "score": 95.5,
        "reason": "åŸºäºæ‚¨çš„è®¿é—®å†å²",
        "type": "booth"
      }
    ],
    "userId": 123,
    "total": 8,
    "algorithm": "personalized"
  }
}
```

### 2.2 ä¸ªæ€§åŒ–å•†å“æ¨è

**æ¥å£åœ°å€ï¼š** `GET /api/recommendations/personalized/products`

**å‚æ•°å’Œå“åº”æ ¼å¼åŒæ¡£å£æ¨è**

### 2.3 ååŒè¿‡æ»¤æ¨è

**æ¥å£åœ°å€ï¼š**

- `GET /api/recommendations/similar-users/booths` - ç›¸ä¼¼ç”¨æˆ·çš„æ¡£å£æ¨è
- `GET /api/recommendations/similar-users/products` - ç›¸ä¼¼ç”¨æˆ·çš„å•†å“æ¨è

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| limit | number | å¦ | æ¨èæ•°é‡ï¼Œé»˜è®¤10 |

### 2.4 è¶‹åŠ¿æ¨è

**æ¥å£åœ°å€ï¼š**

- `GET /api/recommendations/trending/booths` - è¶‹åŠ¿æ¡£å£æ¨è
- `GET /api/recommendations/trending/products` - è¶‹åŠ¿å•†å“æ¨è

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| limit | number | å¦ | æ¨èæ•°é‡ï¼Œé»˜è®¤10 |

### 2.5 æ··åˆæ¨èï¼ˆæ¨èä½¿ç”¨ï¼‰

**æ¥å£åœ°å€ï¼š** `GET /api/recommendations/mixed`

**æè¿°ï¼š** èåˆä¸ªæ€§åŒ–ã€ååŒè¿‡æ»¤ã€è¶‹åŠ¿ä¸‰ç§ç®—æ³•çš„ç»¼åˆæ¨è

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| targetType | string | æ˜¯ | æ¨èç±»å‹ï¼š`booth` æˆ– `product` |
| limit | number | å¦ | æ¨èæ•°é‡ï¼Œé»˜è®¤15 |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "id": "123",
        "score": 98.5,
        "reason": "åŸºäºæ‚¨çš„è®¿é—®å†å²",
        "type": "booth",
        "algorithm": "personalized"
      }
    ],
    "userId": 123,
    "total": 15,
    "algorithm": "mixed",
    "breakdown": {
      "personalized": 5,
      "trending": 4,
      "collaborative": 6,
      "final": 15
    }
  }
}
```

---

## ğŸ“Š ä¸‰ã€ç”¨æˆ·è¡Œä¸ºè®°å½•æ¥å£

### 3.1 è®°å½•ç”¨æˆ·è¡Œä¸º

**æ¥å£åœ°å€ï¼š** `POST /api/behavior/record`

**æè¿°ï¼š** è®°å½•ç”¨æˆ·çš„æµè§ˆã€ç‚¹å‡»ã€æ”¶è—ç­‰è¡Œä¸ºï¼Œç”¨äºä¼˜åŒ–æ¨èç®—æ³•

**è¯·æ±‚å‚æ•°ï¼š**

```json
{
  "userId": 123,
  "behaviorType": "view", // view/click/favorite/share
  "targetType": "booth", // booth/product
  "targetId": "booth_123",
  "sessionId": "optional_session_id",
  "metadata": {
    "source": "homepage", // æ¥æºé¡µé¢
    "position": 1, // åœ¨æ¨èåˆ—è¡¨ä¸­çš„ä½ç½®
    "algorithm": "personalized" // æ¨èç®—æ³•ç±»å‹
  }
}
```

### 3.2 è·å–çƒ­é—¨å†…å®¹

**æ¥å£åœ°å€ï¼š** `GET /api/behavior/popular/{targetType}`

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| targetType | string | æ˜¯ | å†…å®¹ç±»å‹ï¼š`booth` æˆ– `product` |
| days | number | å¦ | ç»Ÿè®¡å¤©æ•°ï¼Œé»˜è®¤7å¤© |
| limit | number | å¦ | è¿”å›æ•°é‡ï¼Œé»˜è®¤10 |

---

## ğŸ¨ å››ã€å‰ç«¯é›†æˆç¤ºä¾‹

### 4.1 é¦–é¡µç»„ä»¶é›†æˆ

```javascript
// Reactç¤ºä¾‹
import React, { useEffect, useState } from 'react';

const Homepage = () => {
  const [homepageData, setHomepageData] = useState(null);
  const [personalizedRecommendations, setPersonalizedRecommendations] =
    useState(null);

  useEffect(() => {
    // åŠ è½½å…¬å¼€é¦–é¡µæ•°æ®
    loadHomepageData();

    // å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼ŒåŠ è½½ä¸ªæ€§åŒ–æ¨è
    if (isLoggedIn()) {
      loadPersonalizedRecommendations();
    }
  }, []);

  const loadHomepageData = async () => {
    try {
      const userId = getCurrentUserId(); // è·å–å½“å‰ç”¨æˆ·IDï¼ˆå¦‚æœå·²ç™»å½•ï¼‰
      const url = userId
        ? `/public/homepage/data?userId=${userId}`
        : '/public/homepage/data';

      const response = await fetch(url);
      const data = await response.json();
      setHomepageData(data.data);
    } catch (error) {
      console.error('åŠ è½½é¦–é¡µæ•°æ®å¤±è´¥:', error);
    }
  };

  const loadPersonalizedRecommendations = async () => {
    try {
      const token = getAuthToken();
      const response = await fetch(
        '/api/recommendations/mixed?targetType=product&limit=12',
        {
          headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        },
      );
      const data = await response.json();
      setPersonalizedRecommendations(data.data);
    } catch (error) {
      console.error('åŠ è½½ä¸ªæ€§åŒ–æ¨èå¤±è´¥:', error);
    }
  };

  // è®°å½•ç”¨æˆ·è¡Œä¸º
  const recordBehavior = async (
    behaviorType,
    targetType,
    targetId,
    metadata = {},
  ) => {
    try {
      const userId = getCurrentUserId();
      await fetch('/api/behavior/record', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          userId,
          behaviorType,
          targetType,
          targetId,
          metadata: {
            source: 'homepage',
            ...metadata,
          },
        }),
      });
    } catch (error) {
      console.error('è®°å½•è¡Œä¸ºå¤±è´¥:', error);
    }
  };

  return (
    <div className="homepage">
      {/* è½®æ’­å›¾åŒºåŸŸ */}
      {homepageData?.banners && (
        <BannerSection
          banners={homepageData.banners}
          onBannerClick={(banner) =>
            recordBehavior('click', 'banner', banner.id)
          }
        />
      )}

      {/* çƒ­é—¨æ¡£å£æ¨è */}
      {homepageData?.recommendations?.hotBooths && (
        <RecommendationSection
          title="çƒ­é—¨æ¡£å£"
          items={homepageData.recommendations.hotBooths}
          onItemClick={(booth, index) =>
            recordBehavior('click', 'booth', booth.id, {
              position: index,
              algorithm: 'hot',
            })
          }
        />
      )}

      {/* ä¸ªæ€§åŒ–æ¨èï¼ˆä»…ç™»å½•ç”¨æˆ·ï¼‰ */}
      {personalizedRecommendations && (
        <RecommendationSection
          title="ä¸ºæ‚¨æ¨è"
          items={personalizedRecommendations.recommendations}
          onItemClick={(item, index) =>
            recordBehavior('click', item.type, item.id, {
              position: index,
              algorithm: item.algorithm,
            })
          }
        />
      )}
    </div>
  );
};
```

### 4.2 æœç´¢é¡µé¢é›†æˆ

```javascript
const SearchPage = () => {
  const [searchResults, setSearchResults] = useState([]);
  const [recommendations, setRecommendations] = useState([]);

  // åœ¨æœç´¢ç»“æœæ—æ˜¾ç¤ºæ¨è
  const loadSearchRecommendations = async (searchType) => {
    try {
      const token = getAuthToken();
      if (token) {
        // å·²ç™»å½•ç”¨æˆ·ï¼šä¸ªæ€§åŒ–æ¨è
        const response = await fetch(
          `/api/recommendations/personalized/${searchType}s?limit=6`,
          {
            headers: { Authorization: `Bearer ${token}` },
          },
        );
        const data = await response.json();
        setRecommendations(data.data.recommendations);
      } else {
        // æœªç™»å½•ç”¨æˆ·ï¼šè¶‹åŠ¿æ¨è
        const response = await fetch(
          `/api/recommendations/trending/${searchType}s?limit=6`,
        );
        const data = await response.json();
        setRecommendations(data.data.recommendations);
      }
    } catch (error) {
      console.error('åŠ è½½æœç´¢æ¨èå¤±è´¥:', error);
    }
  };

  return (
    <div className="search-page">
      <div className="search-results">{/* æœç´¢ç»“æœ */}</div>
      <div className="recommendations">
        <h3>ç›¸å…³æ¨è</h3>
        {recommendations.map((item, index) => (
          <RecommendationItem
            key={item.id}
            item={item}
            onClick={() =>
              recordBehavior('click', item.type, item.id, {
                source: 'search_recommendations',
                position: index,
              })
            }
          />
        ))}
      </div>
    </div>
  );
};
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é”™è¯¯å¤„ç†

- æ‰€æœ‰æ¥å£éƒ½åº”è¯¥æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†
- ç½‘ç»œé”™è¯¯æ—¶æ˜¾ç¤ºé»˜è®¤æ¨èå†…å®¹
- ä¸ªæ€§åŒ–æ¨èå¤±è´¥æ—¶é™çº§åˆ°é€šç”¨æ¨è

### 2. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è¯·æ±‚
- å®ç°éª¨æ¶å±æå‡ç”¨æˆ·ä½“éªŒ
- æ‡’åŠ è½½éå…³é”®æ¨èå†…å®¹

### 3. ç”¨æˆ·ä½“éªŒ

- è®°å½•ç”¨æˆ·è¡Œä¸ºæ—¶ä¸å½±å“é¡µé¢æ€§èƒ½
- æä¾›æ¨èç†ç”±æå‡ç”¨æˆ·ä¿¡ä»»åº¦
- æ”¯æŒæ¨èå†…å®¹çš„åˆ·æ–°åŠŸèƒ½

### 4. æ•°æ®åŸ‹ç‚¹

å»ºè®®åœ¨å…³é”®ä½ç½®æ·»åŠ æ•°æ®åŸ‹ç‚¹ï¼š

```javascript
// æ¨èå†…å®¹æ›å…‰
recordBehavior('view', 'product', productId, {
  source: 'homepage_personalized',
  position: index,
  algorithm: 'mixed',
});

// æ¨èå†…å®¹ç‚¹å‡»
recordBehavior('click', 'product', productId, {
  source: 'homepage_personalized',
  position: index,
  algorithm: 'personalized',
});

// æ¨èå†…å®¹æ”¶è—
recordBehavior('favorite', 'product', productId, {
  source: 'homepage_personalized',
});
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹è¯¦ç»†çš„Swagger APIæ–‡æ¡£ã€‚
