# å‰å°ç³»ç»ŸAPIæ¥å…¥æ–‡æ¡£ - é¦–é¡µæ¨èç³»ç»Ÿ

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº†å‰å°ç³»ç»Ÿæ¥å…¥é¦–é¡µæ¨èç³»ç»Ÿçš„APIæ¥å£ï¼ŒåŒ…æ‹¬å…¬å¼€æ¥å£å’Œä¸ªæ€§åŒ–æ¨èæ¥å£ã€‚ç³»ç»Ÿæä¾›ä¸¤å¥—æ¨èæ–¹æ¡ˆï¼š

- **å…¬å¼€æ¨è**ï¼šé¢å‘æ‰€æœ‰ç”¨æˆ·çš„é€šç”¨æ¨èï¼ˆæ— éœ€ç™»å½•ï¼‰
- **ä¸ªæ€§åŒ–æ¨è**ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºçš„ç²¾å‡†æ¨èï¼ˆéœ€è¦ç™»å½•ï¼‰

## ğŸ–¥ï¸ å¹³å°å·®å¼‚è¯´æ˜

### PCç«¯ vs ç§»åŠ¨ç«¯ä½¿ç”¨æ–¹å¼

| ç‰¹æ€§             | PCç«¯                    | ç§»åŠ¨ç«¯             |
| ---------------- | ----------------------- | ------------------ |
| **æ•°æ®åŠ è½½æ–¹å¼** | ä¸€æ¬¡æ€§å…¨é‡åŠ è½½          | åˆ†é¡µæ»šåŠ¨åŠ è½½       |
| **æ¨èæ¥å£**     | `/public/homepage/data` | å•ç‹¬çš„åˆ†é¡µæ¥å£     |
| **ç”¨æˆ·ä½“éªŒ**     | å®Œæ•´é¡µé¢å±•ç¤º            | æ— é™æ»šåŠ¨ä½“éªŒ       |
| **æ€§èƒ½è€ƒè™‘**     | ä¸€æ¬¡åŠ è½½ï¼Œç¼“å­˜å¤ç”¨      | æŒ‰éœ€åŠ è½½ï¼ŒèŠ‚çœæµé‡ |

### æ¨èä½¿ç”¨åœºæ™¯

- **PCç«¯**ï¼šé€‚åˆå¤§å±å±•ç¤ºï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿæµè§ˆå…¨éƒ¨å†…å®¹
- **ç§»åŠ¨ç«¯**ï¼šé€‚åˆå°å±æ»šåŠ¨ï¼Œå‡å°‘åˆå§‹åŠ è½½æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

## ğŸŒ æ¥å£åŸŸå

```
BASE_URL: http://localhost:3000
```

## ğŸ” è®¤è¯è¯´æ˜

### å…¬å¼€æ¥å£

- æ— éœ€è®¤è¯ï¼Œç›´æ¥è°ƒç”¨

### ä¸ªæ€§åŒ–æ¨èæ¥å£

- éœ€è¦JWT Tokenè®¤è¯
- Headerä¸­æ·»åŠ ï¼š`Authorization: Bearer {token}`

---

## ğŸ“± ä¸€ã€å…¬å¼€æ¨èæ¥å£ï¼ˆæ— éœ€ç™»å½•ï¼‰

### 1.1 è·å–å®Œæ•´é¦–é¡µæ•°æ®ï¼ˆæ¨èPCç«¯ä½¿ç”¨ï¼‰

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/data`

**æè¿°ï¼š** ä¸€æ¬¡æ€§è·å–é¦–é¡µæ‰€éœ€çš„å…¨éƒ¨æ•°æ®ï¼ŒåŒ…æ‹¬è½®æ’­å›¾å’Œå„ç±»æ¨èå†…å®¹

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯é¦–é¡µ
- âŒ ç§»åŠ¨ç«¯ï¼ˆæ•°æ®é‡å¤§ï¼ŒåŠ è½½æ…¢ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| userId | number | å¦ | ç”¨æˆ·IDï¼Œä¼ å…¥åå¯è·å¾—ä¸ªæ€§åŒ–å†…å®¹ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// PCç«¯ - è·å–é€šç”¨é¦–é¡µæ•°æ®
fetch('/public/homepage/data');

// PCç«¯ - è·å–å¸¦ä¸ªæ€§åŒ–çš„é¦–é¡µæ•°æ®ï¼ˆå·²ç™»å½•ç”¨æˆ·ï¼‰
fetch('/public/homepage/data?userId=123');
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "code": 200,
  "message": "è·å–é¦–é¡µæ•°æ®æˆåŠŸ",
  "data": {
    "banners": [
      {
        "id": 1,
        "title": "æ˜¥å­£æ–°å“å‘å¸ƒ",
        "imageUrl": "https://example.com/banner1.jpg",
        "linkUrl": "/products/spring-2024",
        "linkType": "product",
        "targetId": "product_123",
        "sortOrder": 1
      }
    ],
    "recommendations": {
      "hotBooths": [
        {
          "id": "123",
          "boothName": "ç¾é£Ÿæ¡£å£",
          "description": "ç²¾é€‰ç¾é£Ÿ",
          "imageUrl": "https://example.com/booth123.jpg",
          "score": 95.5,
          "market": "åŒ—äº¬æ–°å‘åœ°",
          "address": "AåŒº001å·"
        }
      ],
      "latestBooths": [],
      "hotProducts": [],
      "latestProducts": [],
      "personalizedBooths": [], // ä»…åœ¨ä¼ å…¥userIdæ—¶åŒ…å«
      "personalizedProducts": [] // ä»…åœ¨ä¼ å…¥userIdæ—¶åŒ…å«
    },
    "metadata": {
      "hasPersonalization": false,
      "userType": "guest",
      "generatedAt": "2024-01-01T12:00:00Z"
    },
    "timestamp": "2024-01-01T12:00:00Z",
    "fromCache": true
  }
}
```

### 1.2 è·å–è½®æ’­å›¾ï¼ˆPCç«¯ + ç§»åŠ¨ç«¯é€šç”¨ï¼‰

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/banners`

**æè¿°ï¼š** è·å–é¦–é¡µè½®æ’­å›¾æ•°æ®

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯é¦–é¡µ
- âœ… ç§»åŠ¨ç«¯é¦–é¡µ

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| limit | number | å¦ | æ•°é‡é™åˆ¶ï¼Œé»˜è®¤5å¼  |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// è·å–è½®æ’­å›¾ï¼ˆé€šç”¨ï¼‰
fetch('/public/homepage/banners?limit=5');
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "code": 200,
  "message": "è·å–è½®æ’­å›¾æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "title": "æ˜¥å­£æ–°å“å‘å¸ƒ",
      "imageUrl": "https://example.com/banner1.jpg",
      "linkUrl": "/products/spring-2024",
      "linkType": "product",
      "targetId": "product_123",
      "sortOrder": 1
    }
  ]
}
```

### 1.3 è·å–æ¡£å£æ¨èï¼ˆæ”¯æŒåˆ†é¡µï¼Œæ¨èç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/booth-recommendations`

**æè¿°ï¼š** è·å–æ¡£å£æ¨èæ•°æ®ï¼Œæ”¯æŒåˆ†é¡µåŠ è½½

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯ï¼ˆä¸åˆ†é¡µï¼Œè·å–å…¨éƒ¨ï¼‰
- âœ… ç§»åŠ¨ç«¯ï¼ˆåˆ†é¡µæ»šåŠ¨åŠ è½½ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| type | string | å¦ | æ¨èç±»å‹ï¼š`booth_hot`(çƒ­é—¨) / `booth_new`(æœ€æ–°)ï¼Œé»˜è®¤ `booth_hot` |
| pageNum | number | å¦ | é¡µç ï¼Œä»1å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| pageSize | number | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| limit | number | å¦ | æ€»æ•°é‡é™åˆ¶ï¼ˆPCç«¯ä½¿ç”¨ï¼‰ |
| userId | number | å¦ | ç”¨æˆ·ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// PCç«¯ - è·å–çƒ­é—¨æ¡£å£ï¼ˆä¸åˆ†é¡µï¼‰
fetch('/public/homepage/booth-recommendations?type=booth_hot&limit=8');

// ç§»åŠ¨ç«¯ - åˆ†é¡µè·å–çƒ­é—¨æ¡£å£
fetch(
  '/public/homepage/booth-recommendations?type=booth_hot&pageNum=1&pageSize=10',
);

// ç§»åŠ¨ç«¯ - æ»šåŠ¨åŠ è½½æ›´å¤š
fetch(
  '/public/homepage/booth-recommendations?type=booth_hot&pageNum=2&pageSize=10',
);
```

**å“åº”ç¤ºä¾‹ï¼ˆåˆ†é¡µï¼‰ï¼š**

```json
{
  "code": 200,
  "message": "è·å–æ¡£å£æ¨èæˆåŠŸ",
  "data": {
    "rows": [
      {
        "id": "123",
        "boothName": "ç¾é£Ÿæ¡£å£",
        "description": "ç²¾é€‰ç¾é£Ÿ",
        "imageUrl": "https://example.com/booth123.jpg",
        "score": 95.5,
        "market": "åŒ—äº¬æ–°å‘åœ°",
        "address": "AåŒº001å·",
        "phone": "138****8888"
      }
    ],
    "total": 45,
    "pageNum": 1,
    "pageSize": 10,
    "hasMore": true
  }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆä¸åˆ†é¡µï¼‰ï¼š**

```json
{
  "code": 200,
  "message": "è·å–æ¡£å£æ¨èæˆåŠŸ",
  "data": [
    {
      "id": "123",
      "boothName": "ç¾é£Ÿæ¡£å£",
      "description": "ç²¾é€‰ç¾é£Ÿ",
      "imageUrl": "https://example.com/booth123.jpg",
      "score": 95.5
    }
  ]
}
```

### 1.4 è·å–å•†å“æ¨èï¼ˆæ”¯æŒåˆ†é¡µï¼Œæ¨èç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰

**æ¥å£åœ°å€ï¼š** `GET /public/homepage/product-recommendations`

**æè¿°ï¼š** è·å–å•†å“æ¨èæ•°æ®ï¼Œæ”¯æŒåˆ†é¡µåŠ è½½

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯ï¼ˆä¸åˆ†é¡µï¼Œè·å–å…¨éƒ¨ï¼‰
- âœ… ç§»åŠ¨ç«¯ï¼ˆåˆ†é¡µæ»šåŠ¨åŠ è½½ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| type | string | å¦ | æ¨èç±»å‹ï¼š`product_hot`(çƒ­é—¨) / `product_new`(æœ€æ–°)ï¼Œé»˜è®¤ `product_hot` |
| pageNum | number | å¦ | é¡µç ï¼Œä»1å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| pageSize | number | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤12ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| limit | number | å¦ | æ€»æ•°é‡é™åˆ¶ï¼ˆPCç«¯ä½¿ç”¨ï¼‰ |
| userId | number | å¦ | ç”¨æˆ·ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// PCç«¯ - è·å–çƒ­é—¨å•†å“ï¼ˆä¸åˆ†é¡µï¼‰
fetch('/public/homepage/product-recommendations?type=product_hot&limit=12');

// ç§»åŠ¨ç«¯ - åˆ†é¡µè·å–çƒ­é—¨å•†å“
fetch(
  '/public/homepage/product-recommendations?type=product_hot&pageNum=1&pageSize=12',
);

// ç§»åŠ¨ç«¯ - æ»šåŠ¨åŠ è½½æ›´å¤š
fetch(
  '/public/homepage/product-recommendations?type=product_hot&pageNum=2&pageSize=12',
);
```

**å“åº”ç¤ºä¾‹ï¼ˆåˆ†é¡µï¼‰ï¼š**

```json
{
  "code": 200,
  "message": "è·å–å•†å“æ¨èæˆåŠŸ",
  "data": {
    "rows": [
      {
        "id": 456,
        "name": "æ–°é²œè‹¹æœ",
        "description": "çº¢å¯Œå£«è‹¹æœï¼Œå£æ„Ÿæ¸…è„†",
        "price": 12.5,
        "imageUrl": "https://example.com/apple.jpg",
        "boothId": "123",
        "boothName": "æ°´æœæ¡£å£",
        "score": 92.3
      }
    ],
    "total": 89,
    "pageNum": 1,
    "pageSize": 12,
    "hasMore": true
  }
}
```

---

## ğŸ‘¤ äºŒã€ä¸ªæ€§åŒ–æ¨èæ¥å£ï¼ˆéœ€è¦ç™»å½•ï¼‰

> **é‡è¦ï¼š** æ‰€æœ‰ä¸ªæ€§åŒ–æ¨èæ¥å£éƒ½éœ€è¦åœ¨Headerä¸­æºå¸¦JWT Token

### 2.1 ä¸ªæ€§åŒ–æ¡£å£æ¨èï¼ˆæ”¯æŒåˆ†é¡µï¼‰

**æ¥å£åœ°å€ï¼š** `GET /api/recommendations/personalized/booths`

**è®¤è¯ï¼š** éœ€è¦JWT Token

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯ï¼ˆä¸åˆ†é¡µï¼‰
- âœ… ç§»åŠ¨ç«¯ï¼ˆåˆ†é¡µæ»šåŠ¨åŠ è½½ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| pageNum | number | å¦ | é¡µç ï¼Œä»1å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| pageSize | number | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| limit | number | å¦ | æ¨èæ•°é‡ï¼Œé»˜è®¤10ï¼ˆPCç«¯ä½¿ç”¨ï¼‰ |
| days | number | å¦ | åˆ†ææœ€è¿‘å‡ å¤©çš„è¡Œä¸ºæ•°æ®ï¼Œé»˜è®¤30å¤© |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// PCç«¯ - ä¸ªæ€§åŒ–æ¡£å£æ¨è
fetch('/api/recommendations/personalized/booths?limit=8&days=30', {
  headers: {
    Authorization: `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
});

// ç§»åŠ¨ç«¯ - åˆ†é¡µä¸ªæ€§åŒ–æ¡£å£æ¨è
fetch(
  '/api/recommendations/personalized/booths?pageNum=1&pageSize=10&days=30',
  {
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json',
    },
  },
);
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "rows": [
      {
        "id": "123",
        "score": 95.5,
        "reason": "åŸºäºæ‚¨çš„è®¿é—®å†å²",
        "type": "booth",
        "boothName": "ç¾é£Ÿæ¡£å£",
        "imageUrl": "https://example.com/booth123.jpg"
      }
    ],
    "userId": 123,
    "total": 25,
    "pageNum": 1,
    "pageSize": 10,
    "hasMore": true,
    "algorithm": "personalized"
  }
}
```

### 2.2 ä¸ªæ€§åŒ–å•†å“æ¨èï¼ˆæ”¯æŒåˆ†é¡µï¼‰

**æ¥å£åœ°å€ï¼š** `GET /api/recommendations/personalized/products`

**å‚æ•°å’Œå“åº”æ ¼å¼åŒä¸ªæ€§åŒ–æ¡£å£æ¨è**

### 2.3 æ··åˆæ¨èï¼ˆæ¨èä½¿ç”¨ï¼Œæ”¯æŒåˆ†é¡µï¼‰

**æ¥å£åœ°å€ï¼š** `GET /api/recommendations/mixed`

**æè¿°ï¼š** èåˆä¸ªæ€§åŒ–ã€ååŒè¿‡æ»¤ã€è¶‹åŠ¿ä¸‰ç§ç®—æ³•çš„ç»¼åˆæ¨è

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯ï¼ˆä¸åˆ†é¡µï¼‰
- âœ… ç§»åŠ¨ç«¯ï¼ˆåˆ†é¡µæ»šåŠ¨åŠ è½½ï¼‰

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| targetType | string | æ˜¯ | æ¨èç±»å‹ï¼š`booth` æˆ– `product` |
| pageNum | number | å¦ | é¡µç ï¼Œä»1å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| pageSize | number | å¦ | æ¯é¡µæ•°é‡ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| limit | number | å¦ | æ¨èæ•°é‡ï¼Œé»˜è®¤15ï¼ˆPCç«¯ä½¿ç”¨ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```javascript
// PCç«¯ - æ··åˆæ¨è
fetch('/api/recommendations/mixed?targetType=product&limit=15', {
  headers: { Authorization: `Bearer ${token}` },
});

// ç§»åŠ¨ç«¯ - åˆ†é¡µæ··åˆæ¨è
fetch('/api/recommendations/mixed?targetType=product&pageNum=1&pageSize=10', {
  headers: { Authorization: `Bearer ${token}` },
});
```

---

## ğŸ“Š ä¸‰ã€ç”¨æˆ·è¡Œä¸ºè®°å½•æ¥å£

### 3.1 è®°å½•ç”¨æˆ·è¡Œä¸º

**æ¥å£åœ°å€ï¼š** `POST /api/behavior/record`

**æè¿°ï¼š** è®°å½•ç”¨æˆ·çš„æµè§ˆã€ç‚¹å‡»ã€æ”¶è—ç­‰è¡Œä¸ºï¼Œç”¨äºä¼˜åŒ–æ¨èç®—æ³•

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… PCç«¯
- âœ… ç§»åŠ¨ç«¯

**è¯·æ±‚å‚æ•°ï¼š**

```json
{
  "userId": 123,
  "behaviorType": "view", // view/click/favorite/share
  "targetType": "booth", // booth/product
  "targetId": "booth_123",
  "sessionId": "optional_session_id",
  "metadata": {
    "source": "homepage", // æ¥æºé¡µé¢
    "platform": "mobile", // pc/mobile
    "position": 1, // åœ¨æ¨èåˆ—è¡¨ä¸­çš„ä½ç½®
    "algorithm": "personalized", // æ¨èç®—æ³•ç±»å‹
    "pageNum": 1 // ç§»åŠ¨ç«¯åˆ†é¡µä¿¡æ¯
  }
}
```

### 3.2 è·å–çƒ­é—¨å†…å®¹ï¼ˆæ”¯æŒåˆ†é¡µï¼‰

**æ¥å£åœ°å€ï¼š** `GET /api/behavior/popular/{targetType}`

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| targetType | string | æ˜¯ | å†…å®¹ç±»å‹ï¼š`booth` æˆ– `product` |
| pageNum | number | å¦ | é¡µç ï¼Œä»1å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| pageSize | number | å¦ | æ¯é¡µæ•°é‡ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰ |
| days | number | å¦ | ç»Ÿè®¡å¤©æ•°ï¼Œé»˜è®¤7å¤© |
| limit | number | å¦ | è¿”å›æ•°é‡ï¼Œé»˜è®¤10ï¼ˆPCç«¯ä½¿ç”¨ï¼‰ |

---

## ğŸ¨ å››ã€å‰ç«¯é›†æˆç¤ºä¾‹

### 4.1 PCç«¯é¦–é¡µç»„ä»¶é›†æˆ

```javascript
// Reactç¤ºä¾‹ - PCç«¯
import React, { useEffect, useState } from 'react';

const PCHomepage = () => {
  const [homepageData, setHomepageData] = useState(null);
  const [personalizedRecommendations, setPersonalizedRecommendations] =
    useState(null);

  useEffect(() => {
    // PCç«¯ï¼šä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®
    loadHomepageData();

    // å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼ŒåŠ è½½ä¸ªæ€§åŒ–æ¨è
    if (isLoggedIn()) {
      loadPersonalizedRecommendations();
    }
  }, []);

  const loadHomepageData = async () => {
    try {
      const userId = getCurrentUserId();
      const url = userId
        ? `/public/homepage/data?userId=${userId}`
        : '/public/homepage/data';

      const response = await fetch(url);
      const data = await response.json();
      setHomepageData(data.data);
    } catch (error) {
      console.error('åŠ è½½é¦–é¡µæ•°æ®å¤±è´¥:', error);
    }
  };

  const loadPersonalizedRecommendations = async () => {
    try {
      const token = getAuthToken();
      const response = await fetch(
        '/api/recommendations/mixed?targetType=product&limit=12',
        {
          headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        },
      );
      const data = await response.json();
      setPersonalizedRecommendations(data.data);
    } catch (error) {
      console.error('åŠ è½½ä¸ªæ€§åŒ–æ¨èå¤±è´¥:', error);
    }
  };

  const recordBehavior = async (
    behaviorType,
    targetType,
    targetId,
    metadata = {},
  ) => {
    try {
      const userId = getCurrentUserId();
      await fetch('/api/behavior/record', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId,
          behaviorType,
          targetType,
          targetId,
          metadata: {
            source: 'homepage',
            platform: 'pc',
            ...metadata,
          },
        }),
      });
    } catch (error) {
      console.error('è®°å½•è¡Œä¸ºå¤±è´¥:', error);
    }
  };

  return (
    <div className="pc-homepage">
      {/* è½®æ’­å›¾åŒºåŸŸ */}
      {homepageData?.banners && (
        <BannerSection
          banners={homepageData.banners}
          onBannerClick={(banner) =>
            recordBehavior('click', 'banner', banner.id)
          }
        />
      )}

      {/* çƒ­é—¨æ¡£å£æ¨è */}
      {homepageData?.recommendations?.hotBooths && (
        <RecommendationSection
          title="çƒ­é—¨æ¡£å£"
          items={homepageData.recommendations.hotBooths}
          onItemClick={(booth, index) =>
            recordBehavior('click', 'booth', booth.id, {
              position: index,
              algorithm: 'hot',
            })
          }
        />
      )}

      {/* ä¸ªæ€§åŒ–æ¨èï¼ˆä»…ç™»å½•ç”¨æˆ·ï¼‰ */}
      {personalizedRecommendations && (
        <RecommendationSection
          title="ä¸ºæ‚¨æ¨è"
          items={personalizedRecommendations.recommendations}
          onItemClick={(item, index) =>
            recordBehavior('click', item.type, item.id, {
              position: index,
              algorithm: item.algorithm,
            })
          }
        />
      )}
    </div>
  );
};
```

### 4.2 ç§»åŠ¨ç«¯é¦–é¡µç»„ä»¶é›†æˆï¼ˆæ”¯æŒæ— é™æ»šåŠ¨ï¼‰

```javascript
// Reactç¤ºä¾‹ - ç§»åŠ¨ç«¯
import React, { useEffect, useState, useCallback } from 'react';
import { useInfiniteScroll } from './hooks/useInfiniteScroll';

const MobileHomepage = () => {
  const [banners, setBanners] = useState([]);
  const [hotBooths, setHotBooths] = useState([]);
  const [hotProducts, setHotProducts] = useState([]);
  const [loading, setLoading] = useState(false);
  const [hasMore, setHasMore] = useState(true);
  const [currentPage, setCurrentPage] = useState(1);

  useEffect(() => {
    // ç§»åŠ¨ç«¯ï¼šåˆ†æ‰¹åŠ è½½æ•°æ®
    loadInitialData();
  }, []);

  const loadInitialData = async () => {
    try {
      // åŠ è½½è½®æ’­å›¾
      const bannerResponse = await fetch('/public/homepage/banners?limit=5');
      const bannerData = await bannerResponse.json();
      setBanners(bannerData.data);

      // åŠ è½½ç¬¬ä¸€é¡µçƒ­é—¨æ¡£å£
      await loadMoreBooths();
    } catch (error) {
      console.error('åŠ è½½åˆå§‹æ•°æ®å¤±è´¥:', error);
    }
  };

  const loadMoreBooths = useCallback(async () => {
    if (loading || !hasMore) return;

    setLoading(true);
    try {
      const response = await fetch(
        `/public/homepage/booth-recommendations?type=booth_hot&pageNum=${currentPage}&pageSize=10`,
      );
      const data = await response.json();

      if (data.data.rows.length > 0) {
        setHotBooths((prev) => [...prev, ...data.data.rows]);
        setCurrentPage((prev) => prev + 1);
        setHasMore(data.data.hasMore);
      } else {
        setHasMore(false);
      }
    } catch (error) {
      console.error('åŠ è½½æ›´å¤šæ¡£å£å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }, [currentPage, loading, hasMore]);

  const loadMoreProducts = async (page = 1) => {
    try {
      const response = await fetch(
        `/public/homepage/product-recommendations?type=product_hot&pageNum=${page}&pageSize=12`,
      );
      const data = await response.json();

      if (page === 1) {
        setHotProducts(data.data.rows);
      } else {
        setHotProducts((prev) => [...prev, ...data.data.rows]);
      }

      return data.data.hasMore;
    } catch (error) {
      console.error('åŠ è½½å•†å“å¤±è´¥:', error);
      return false;
    }
  };

  // ä½¿ç”¨æ— é™æ»šåŠ¨hook
  const [isFetching, setIsFetching] = useInfiniteScroll(loadMoreBooths);

  const recordBehavior = async (
    behaviorType,
    targetType,
    targetId,
    metadata = {},
  ) => {
    try {
      const userId = getCurrentUserId();
      await fetch('/api/behavior/record', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId,
          behaviorType,
          targetType,
          targetId,
          metadata: {
            source: 'homepage',
            platform: 'mobile',
            pageNum: currentPage,
            ...metadata,
          },
        }),
      });
    } catch (error) {
      console.error('è®°å½•è¡Œä¸ºå¤±è´¥:', error);
    }
  };

  return (
    <div className="mobile-homepage">
      {/* è½®æ’­å›¾åŒºåŸŸ */}
      <BannerSection
        banners={banners}
        onBannerClick={(banner) => recordBehavior('click', 'banner', banner.id)}
      />

      {/* çƒ­é—¨æ¡£å£æ¨è - æ— é™æ»šåŠ¨ */}
      <InfiniteScrollSection
        title="çƒ­é—¨æ¡£å£"
        items={hotBooths}
        loading={loading}
        hasMore={hasMore}
        onItemClick={(booth, index) =>
          recordBehavior('click', 'booth', booth.id, {
            position: index,
            algorithm: 'hot',
          })
        }
      />

      {/* çƒ­é—¨å•†å“æ¨è - åˆ†é¡µåŠ è½½ */}
      <PaginatedSection
        title="çƒ­é—¨å•†å“"
        items={hotProducts}
        onLoadMore={loadMoreProducts}
        onItemClick={(product, index) =>
          recordBehavior('click', 'product', product.id, {
            position: index,
            algorithm: 'hot',
          })
        }
      />

      {/* åŠ è½½æŒ‡ç¤ºå™¨ */}
      {loading && <LoadingIndicator />}
    </div>
  );
};

// æ— é™æ»šåŠ¨Hook
const useInfiniteScroll = (callback) => {
  const [isFetching, setIsFetching] = useState(false);

  useEffect(() => {
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  useEffect(() => {
    if (!isFetching) return;
    fetchMoreData();
  }, [isFetching]);

  const handleScroll = () => {
    if (
      window.innerHeight + document.documentElement.scrollTop !==
        document.documentElement.offsetHeight ||
      isFetching
    )
      return;
    setIsFetching(true);
  };

  const fetchMoreData = useCallback(async () => {
    await callback();
    setIsFetching(false);
  }, [callback]);

  return [isFetching, setIsFetching];
};
```

### 4.3 æœç´¢é¡µé¢é›†æˆï¼ˆç§»åŠ¨ç«¯åˆ†é¡µï¼‰

```javascript
const MobileSearchPage = () => {
  const [searchResults, setSearchResults] = useState([]);
  const [recommendations, setRecommendations] = useState([]);
  const [currentPage, setCurrentPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);

  // åœ¨æœç´¢ç»“æœæ—æ˜¾ç¤ºæ¨èï¼ˆåˆ†é¡µåŠ è½½ï¼‰
  const loadSearchRecommendations = async (searchType, page = 1) => {
    try {
      const token = getAuthToken();
      let url;

      if (token) {
        // å·²ç™»å½•ç”¨æˆ·ï¼šä¸ªæ€§åŒ–æ¨è
        url = `/api/recommendations/personalized/${searchType}s?pageNum=${page}&pageSize=6`;
      } else {
        // æœªç™»å½•ç”¨æˆ·ï¼šè¶‹åŠ¿æ¨è
        url = `/api/recommendations/trending/${searchType}s?pageNum=${page}&pageSize=6`;
      }

      const response = await fetch(url, {
        headers: token ? { Authorization: `Bearer ${token}` } : {},
      });
      const data = await response.json();

      if (page === 1) {
        setRecommendations(data.data.rows || data.data.recommendations);
      } else {
        setRecommendations((prev) => [
          ...prev,
          ...(data.data.rows || data.data.recommendations),
        ]);
      }

      return data.data.hasMore || false;
    } catch (error) {
      console.error('åŠ è½½æœç´¢æ¨èå¤±è´¥:', error);
      return false;
    }
  };

  return (
    <div className="mobile-search-page">
      <div className="search-results">{/* æœç´¢ç»“æœ */}</div>
      <div className="recommendations">
        <h3>ç›¸å…³æ¨è</h3>
        <InfiniteScrollList
          items={recommendations}
          onLoadMore={() =>
            loadSearchRecommendations('product', currentPage + 1)
          }
          onItemClick={(item, index) =>
            recordBehavior('click', item.type, item.id, {
              source: 'search_recommendations',
              platform: 'mobile',
              position: index,
              pageNum: Math.floor(index / 6) + 1,
            })
          }
        />
      </div>
    </div>
  );
};
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¹³å°å·®å¼‚å¤„ç†

#### PCç«¯æ³¨æ„äº‹é¡¹

- ä½¿ç”¨å…¨é‡æ•°æ®åŠ è½½æ¥å£ `/public/homepage/data`
- ä¸€æ¬¡æ€§å±•ç¤ºæ‰€æœ‰æ¨èå†…å®¹
- æ³¨é‡ç¼“å­˜ç­–ç•¥ï¼Œé¿å…é‡å¤è¯·æ±‚
- é€‚åˆå¤§å±å±•ç¤ºï¼Œå¯ä»¥æ˜¾ç¤ºæ›´å¤šä¿¡æ¯

#### ç§»åŠ¨ç«¯æ³¨æ„äº‹é¡¹

- ä½¿ç”¨åˆ†é¡µæ¥å£è¿›è¡Œæ— é™æ»šåŠ¨
- é¦–å±å¿«é€ŸåŠ è½½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- æ³¨æ„æµé‡æ§åˆ¶ï¼ŒæŒ‰éœ€åŠ è½½
- é€‚é…å°å±æ˜¾ç¤ºï¼Œç®€åŒ–ä¿¡æ¯å±•ç¤º

### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### PCç«¯ä¼˜åŒ–

```javascript
// ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤è¯·æ±‚
const cache = new Map();
const getCachedData = async (url) => {
  if (cache.has(url)) {
    return cache.get(url);
  }
  const data = await fetch(url);
  cache.set(url, data);
  return data;
};
```

#### ç§»åŠ¨ç«¯ä¼˜åŒ–

```javascript
// é¢„åŠ è½½ä¸‹ä¸€é¡µæ•°æ®
const preloadNextPage = useCallback(() => {
  if (hasMore && !loading) {
    setTimeout(() => loadMoreData(), 1000);
  }
}, [hasMore, loading]);

// è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ•°æ®é‡å¤§æ—¶ï¼‰
const VirtualScrollList = ({ items, itemHeight, containerHeight }) => {
  // å®ç°è™šæ‹Ÿæ»šåŠ¨é€»è¾‘
};
```

### 3. æ•°æ®åŸ‹ç‚¹å·®å¼‚

```javascript
// PCç«¯åŸ‹ç‚¹
recordBehavior('view', 'product', productId, {
  source: 'homepage_personalized',
  platform: 'pc',
  position: index,
  algorithm: 'mixed',
});

// ç§»åŠ¨ç«¯åŸ‹ç‚¹
recordBehavior('view', 'product', productId, {
  source: 'homepage_personalized',
  platform: 'mobile',
  position: index,
  pageNum: currentPage,
  algorithm: 'mixed',
  scrollPosition: window.scrollY,
});
```

### 4. é”™è¯¯å¤„ç†

```javascript
// ç½‘ç»œé”™è¯¯é™çº§ç­–ç•¥
const loadDataWithFallback = async (primaryUrl, fallbackUrl) => {
  try {
    return await fetch(primaryUrl);
  } catch (error) {
    console.warn('ä¸»æ¥å£å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ¥å£');
    return await fetch(fallbackUrl);
  }
};

// ç§»åŠ¨ç«¯ç½‘ç»œçŠ¶æ€æ£€æµ‹
if ('connection' in navigator) {
  const connection = navigator.connection;
  if (
    connection.effectiveType === 'slow-2g' ||
    connection.effectiveType === '2g'
  ) {
    // é™ä½æ•°æ®è¯·æ±‚é¢‘ç‡
    pageSize = 5;
  }
}
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å¼€å‘å›¢é˜Ÿæˆ–æŸ¥çœ‹è¯¦ç»†çš„Swagger APIæ–‡æ¡£ã€‚

### å¸¸è§é—®é¢˜

**Q: PCç«¯å’Œç§»åŠ¨ç«¯å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¥å£å—ï¼Ÿ**
A: å¯ä»¥ï¼Œä½†å»ºè®®æŒ‰ç…§æ–‡æ¡£è¯´æ˜é€‰æ‹©æœ€é€‚åˆçš„æ¥å£ã€‚PCç«¯ä½¿ç”¨å…¨é‡æ¥å£æ•ˆç‡æ›´é«˜ï¼Œç§»åŠ¨ç«¯ä½¿ç”¨åˆ†é¡µæ¥å£ä½“éªŒæ›´å¥½ã€‚

**Q: ç§»åŠ¨ç«¯æ— é™æ»šåŠ¨å¦‚ä½•åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®ï¼Ÿ**
A: åˆ†é¡µæ¥å£ä¼šè¿”å› `hasMore` å­—æ®µï¼Œå½“ä¸º `false` æ—¶è¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®ã€‚

**Q: å¦‚ä½•å¤„ç†ç½‘ç»œå¼‚å¸¸æƒ…å†µï¼Ÿ**
A: å»ºè®®å®ç°é™çº§ç­–ç•¥ï¼Œä¸ªæ€§åŒ–æ¨èå¤±è´¥æ—¶æ˜¾ç¤ºé€šç”¨æ¨èï¼Œåˆ†é¡µåŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé‡è¯•æŒ‰é’®ã€‚
